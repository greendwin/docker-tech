version: '3'

services:
  master:
    image: salt-master
    build: ./salt-master
    volumes:
      - ./salt:/srv/salt
      - ./salt-master/conf:/etc/salt/master.d
      - salt-master-cache:/var/cache/salt
      - salt-master-pki:/etc/salt/pki
      - salt-master-logs:/var/log/salt

  minion:
    image: salt-minion-vs-docker
    build: ./salt-minion
    links:
      - master:salt
    volumes:
      - ./salt-minion/conf:/etc/salt/minion.d
      - salt-minion-logs:/var/log/salt

      # share minion with outer docker container
      - /run/docker.sock:/run/docker.sock

      # share host directory for further salt-minion work
      - /data:/data

volumes:
  salt-master-pki:
  salt-master-cache:
  salt-master-logs:
  salt-minion-logs:
